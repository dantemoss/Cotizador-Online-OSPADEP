<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Online OSPADEP - Planes de Salud</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Archivos de configuración y seguridad -->
    <script src="config.js"></script>
    <script src="security.js"></script>
    <script src="user-system.js"></script>
    <script src="auth-system.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1><i class="fas fa-heartbeat"></i> OSPADEP</h1>
                <p>Obra Social del Personal de Aeronavegación de Entes Privados</p>
            </div>
            <div class="user-section">
                <!-- Cuando no hay usuario logueado -->
                <div class="login-section" id="login-section">
                    <!-- Panel de administración oculto - Solo accesible por método secreto -->
                    <button class="header-login-btn" onclick="showAdminLogin()" style="display: none;" id="secret-admin-btn">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                </div>
                <!-- Cuando hay usuario logueado -->
                <div class="user-info-section" id="user-info-section" style="display: none;">
                    <div class="user-greeting">
                        <span class="user-name" id="header-user-name">Usuario</span>
                        <span class="user-role" id="header-user-role">Admin</span>
                    </div>
                    <div class="user-menu">
                        <button class="user-menu-btn" onclick="showUserMenu()">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Banner de información de precios -->
        <div class="price-update-banner">
            <div class="banner-content">
                <i class="fas fa-calendar-alt banner-icon"></i>
                <span class="banner-text">Precios actualizados para <strong>ENERO</strong></span>
                <span class="banner-text"><strong>SWISS MEDICAL, ACTIVA SALUD Y MEDIFE ACTUALIZADOS</strong></span>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Formulario Principal -->
            <div class="form-section" id="form-section">
                <div class="form-card">
                    <!-- Progress Indicator -->
                    <div class="progress-container">
                        <div class="progress-step active" data-step="1">
                            <div class="step-number">1</div>
                            <span class="step-label">Tipo de Plan</span>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="2">
                            <div class="step-number">2</div>
                            <span class="step-label">Información</span>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="3">
                            <div class="step-number">3</div>
                            <span class="step-label">Cotización</span>
                        </div>
                    </div>

                    <div class="form-content">
                        <h2>¿Para quién estás buscando un plan?</h2>
                        <p class="subtitle">Selecciona la opción que mejor se ajuste a tu situación familiar</p>
                        
                        <div class="options-container">
                            <div class="option-item" data-option="solo">
                                <div class="option-content">
                                    <div class="option-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="option-text">
                                        <h3>Para mí</h3>
                                        <p>Plan individual para una persona</p>
                                    </div>
                                </div>
                                <div class="option-radio">
                                    <div class="radio-button"></div>
                                </div>
                            </div>
                            
                            <div class="option-item" data-option="pareja">
                                <div class="option-content">
                                    <div class="option-icon">
                                        <i class="fas fa-user-friends"></i>
                                    </div>
                                    <div class="option-text">
                                        <h3>Para mí y mi pareja</h3>
                                        <p>Plan familiar para 2 personas</p>
                                    </div>
                                </div>
                                <div class="option-radio">
                                    <div class="radio-button"></div>
                                </div>
                            </div>
                            
                            <div class="option-item" data-option="hijos">
                                <div class="option-content">
                                    <div class="option-icon">
                                        <i class="fas fa-baby"></i>
                                    </div>
                                    <div class="option-text">
                                        <h3>Para mí y mis hijos</h3>
                                        <p>Plan familiar con hijos incluidos</p>
                                    </div>
                                </div>
                                <div class="option-radio">
                                    <div class="radio-button"></div>
                                </div>
                            </div>
                            
                            <div class="option-item" data-option="familia">
                                <div class="option-content">
                                    <div class="option-icon">
                                        <i class="fas fa-home"></i>
                                    </div>
                                    <div class="option-text">
                                        <h3>Para mi familia completa</h3>
                                        <p>Pareja e hijos incluidos</p>
                                    </div>
                                </div>
                                <div class="option-radio">
                                    <div class="radio-button"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="continue-button" id="continue-btn" disabled>
                                Continuar <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulario de Detalles -->
            <div class="details-section" id="details-section" style="display: none;">
                <div class="form-card">
                    <!-- Progress Indicator -->
                    <div class="progress-container">
                        <div class="progress-step completed" data-step="1">
                            <div class="step-number"><i class="fas fa-check"></i></div>
                            <span class="step-label">Tipo de Plan</span>
                        </div>
                        <div class="progress-line completed"></div>
                        <div class="progress-step active" data-step="2">
                            <div class="step-number">2</div>
                            <span class="step-label">Información</span>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="3">
                            <div class="step-number">3</div>
                            <span class="step-label">Cotización</span>
                        </div>
                    </div>

                    <div class="form-content">
                        <div class="form-header">
                            <button class="back-button" onclick="goBack()">
                                <i class="fas fa-arrow-left"></i> Volver
                            </button>
                            <h2 id="details-title">Información Personal</h2>
                            <p class="subtitle">Completa los datos para generar tu cotización personalizada</p>
                        </div>
                        
                        <form id="cotization-form" class="modern-form">
                            <div class="form-sections" id="form-fields">
                                <!-- Los campos se generarán dinámicamente con JavaScript -->
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="back-step-button" onclick="goBack()">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="submit" class="continue-button">
                                    <i class="fas fa-calculator"></i> Cotizar Plan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Sección de Planes -->
            <div class="plans-section" id="plans-section" style="display: none;">
                <div class="plans-container">
                    <!-- Progress Indicator -->
                    <div class="progress-container">
                        <div class="progress-step completed" data-step="1">
                            <div class="step-number"><i class="fas fa-check"></i></div>
                            <span class="step-label">Tipo de Plan</span>
                        </div>
                        <div class="progress-line completed"></div>
                        <div class="progress-step completed" data-step="2">
                            <div class="step-number"><i class="fas fa-check"></i></div>
                            <span class="step-label">Información</span>
                        </div>
                        <div class="progress-line completed"></div>
                        <div class="progress-step active" data-step="3">
                            <div class="step-number">3</div>
                            <span class="step-label">Cotización</span>
                        </div>
                    </div>

                    <div class="form-content">
                        <div class="form-header">
                            <div class="header-top-row">
                                <button class="back-button" onclick="goToDetails()">
                                    <i class="fas fa-arrow-left"></i> Modificar datos
                                </button>
                                <!-- Filtro de prestadores en el header -->
                                <div id="prestador-filter-bar" class="prestador-filter-bar header-filter"></div>
                            </div>
                            <div class="header-content">
                                <h2><i class="fas fa-clipboard-list"></i> Planes Disponibles</h2>
                                <p class="subtitle">Estos son los planes que se ajustan a tu perfil</p>
                            </div>
                        </div>
                    <!-- Grilla de planes -->
                    <div id="plans-grid" class="plans-grid">
                        <!-- Los planes se generarán dinámicamente -->
                    </div>
                    </div>
                </div>
            </div>

            <!-- Panel Administrativo -->
            <div class="admin-section" id="admin-section" style="display: none;">
                <div class="admin-container">
                    <div class="admin-header">
                        <button class="back-button" onclick="goToMainPage()">
                            <i class="fas fa-arrow-left"></i> Volver al cotizador
                        </button>
                        <h2><i class="fas fa-cogs"></i> Panel Administrativo</h2>
                        <p class="subtitle">Gestión de precios y configuración de planes</p>
                    </div>

                    <!-- Sección de gestión de precios -->
                    <div class="admin-content">
                        <div class="admin-controls">
                            <div class="admin-actions">
                                <div class="admin-actions-row">
                                    <button class="admin-btn primary large" onclick="showExternalPricing()">
                                        <i class="fas fa-cogs"></i> Gestión de Precios
                                    </button>
                                </div>
                                <div class="admin-actions-row">
                                    <button class="admin-btn secondary" onclick="goToMainPage()">
                                        <i class="fas fa-arrow-left"></i> Volver al Cotizador
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Nueva Sección: Gestión de Precios Externos -->
                        <div class="external-pricing-section" id="external-pricing-section" style="display: none;">
                            <div class="external-pricing-container">
                                <!-- Header del Panel -->
                                <div class="external-header">
                                    <div class="header-content">
                                        <div class="header-left">
                                            <div class="header-icon">
                                                <i class="fas fa-cogs"></i>
                                            </div>
                                            <div class="header-text">
                                                <h2>Gestión de Precios</h2>
                                                <p>Sistema avanzado de actualización de precios</p>
                                            </div>
                                        </div>
                                        <div class="header-right">
                                            <div class="status-card">
                                                <div class="status-indicator active" id="external-status"></div>
                                                <div class="status-details">
                                                    <span class="status-label" id="status-text">Precios externos cargados</span>
                                                    <span class="version-label">v<span id="current-version">2025-09</span></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Navegación de Pestañas -->
                                <div class="external-nav">
                                    <button class="nav-tab active" data-tab="percentage" onclick="switchExternalTab('percentage')">
                                        <i class="fas fa-percentage"></i>
                                        <span>Actualización por Porcentaje</span>
                                        <small>La forma más rápida</small>
                                    </button>
                                    <button class="nav-tab" data-tab="csv" onclick="switchExternalTab('csv')">
                                        <i class="fas fa-file-csv"></i>
                                        <span>Importar desde CSV</span>
                                        <small>Usa tus archivos existentes</small>
                                    </button>
                                    <button class="nav-tab" data-tab="manual" onclick="switchExternalTab('manual')">
                                        <i class="fas fa-code"></i>
                                        <span>Editor Manual</span>
                                        <small>Control total</small>
                                    </button>
                                </div>

                                <!-- Contenido de las Pestañas -->
                                <div class="external-content">
                                    
                                    <!-- Tab 1: Actualización por Porcentaje -->
                                    <div class="tab-panel active" id="tab-percentage">
                                        <div class="tab-panel-header">
                                            <h4><i class="fas fa-calculator"></i> Aplicar Aumentos por Porcentaje</h4>
                                            <p>Ingresa el porcentaje de aumento para cada prestador. Usa números positivos para aumentos y negativos para descuentos.</p>
                                        </div>
                                        
                                        <div class="prestadores-grid">
                                            <!-- OMINT Card -->
                                            <div class="prestador-card omint-card">
                                                <div class="prestador-header">
                                                    <div class="prestador-logo">
                                                        <img src="logosEmpresas/omint.png" alt="OMINT Logo" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                        <div class="logo-circle omint-logo" style="display: none;"><span>O</span></div>
                                                    </div>
                                                    <div class="prestador-info">
                                                        <h5>OMINT</h5>
                                                        <span class="prestador-subtitle">Medicina Prepaga</span>
                                                    </div>
                                                </div>
                                                <div class="prestador-input-container">
                                                    <div class="input-group">
                                                        <input type="number" id="omint-percent" step="0.1" placeholder="0.0" class="prestador-input">
                                                        <span class="input-suffix">%</span>
                                                    </div>
                                                    <small class="input-help">Ej: 3.5 para aumento del 3.5%</small>
                                                </div>
                                            </div>

                                            <!-- SWISS MEDICAL Card -->
                                            <div class="prestador-card swiss-card">
                                                <div class="prestador-header">
                                                    <div class="prestador-logo">
                                                        <img src="logosEmpresas/swissmedical.png" alt="Swiss Medical Logo" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                        <div class="logo-circle swiss-logo" style="display: none;"><span>S</span></div>
                                                    </div>
                                                    <div class="prestador-info">
                                                        <h5>SWISS MEDICAL</h5>
                                                        <span class="prestador-subtitle">Medicina Prepaga</span>
                                                    </div>
                                                </div>
                                                <div class="prestador-input-container">
                                                    <div class="input-group">
                                                        <input type="number" id="swiss-percent" step="0.1" placeholder="0.0" class="prestador-input">
                                                        <span class="input-suffix">%</span>
                                                    </div>
                                                    <small class="input-help">Ej: 2.8 para aumento del 2.8%</small>
                                                </div>
                                            </div>

                                            <!-- ACTIVA SALUD Card -->
                                            <div class="prestador-card activa-card">
                                                <div class="prestador-header">
                                                    <div class="prestador-logo">
                                                        <img src="logosEmpresas/activasalud.png" alt="Activa Salud Logo" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                        <div class="logo-circle activa-logo" style="display: none;"><span>A</span></div>
                                                    </div>
                                                    <div class="prestador-info">
                                                        <h5>ACTIVA SALUD</h5>
                                                        <span class="prestador-subtitle">Medicina Prepaga</span>
                                                    </div>
                                                </div>
                                                <div class="prestador-input-container">
                                                    <div class="input-group">
                                                        <input type="number" id="activa-percent" step="0.1" placeholder="0.0" class="prestador-input">
                                                        <span class="input-suffix">%</span>
                                                    </div>
                                                    <small class="input-help">Ej: 1.9 para aumento del 1.9%</small>
                                                </div>
                                            </div>

                                            <!-- MEDIFE Card -->
                                            <div class="prestador-card medife-card">
                                                <div class="prestador-header">
                                                    <div class="prestador-logo">
                                                        <img src="logosEmpresas/medife.png" alt="MEDIFE Logo" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                        <div class="logo-circle medife-logo" style="display: none;"><span>M</span></div>
                                                    </div>
                                                    <div class="prestador-info">
                                                        <h5>MEDIFE</h5>
                                                        <span class="prestador-subtitle">Medicina Prepaga</span>
                                                    </div>
                                                </div>
                                                <div class="prestador-input-container">
                                                    <div class="input-group">
                                                        <input type="number" id="medife-percent" step="0.1" placeholder="0.0" class="prestador-input">
                                                        <span class="input-suffix">%</span>
                                                    </div>
                                                    <small class="input-help">Ej: 3.6 para aumento del 3.6%</small>
                                                </div>
                                            </div>

                                            <!-- OSPADEP SALUD Card -->
                                            <div class="prestador-card ospadep-card">
                                                <div class="prestador-header">
                                                    <div class="prestador-logo">
                                                        <img src="logosEmpresas/OSPADEPSalud.png" alt="OSPADEP SALUD Logo" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                        <div class="logo-circle ospadep-logo" style="display: none;"><span>OS</span></div>
                                                    </div>
                                                    <div class="prestador-info">
                                                        <h5>OSPADEP SALUD</h5>
                                                        <span class="prestador-subtitle">Medicina Prepaga</span>
                                                    </div>
                                                </div>
                                                <div class="prestador-input-container">
                                                    <div class="input-group">
                                                        <input type="number" id="ospadep-percent" step="0.1" placeholder="0.0" class="prestador-input">
                                                        <span class="input-suffix">%</span>
                                                    </div>
                                                    <small class="input-help">Ej: 3.0 para aumento del 3.0%</small>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Sección Aplicar Descuento -->
                                        <div class="admin-tool-section discount-section">
                                            <div class="tool-header">
                                                <div class="tool-icon discount-icon">
                                                    <i class="fas fa-percentage"></i>
                                                </div>
                                                <div class="tool-info">
                                                    <h4>Aplicar Descuento</h4>
                                                    <p>Reduce precios con porcentajes directos. Operación simétrica a los aumentos.</p>
                                                </div>
                                            </div>
                                            
                                            <div class="tool-content">
                                                <div class="form-group">
                                                    <label class="form-label">
                                                        <i class="fas fa-building"></i>
                                                        Prestador afectado
                                                    </label>
                                                    <select id="revert-prestador" class="form-select">
                                                        <option value="">Seleccionar prestador</option>
                                                        <option value="omint">OMINT</option>
                                                        <option value="swiss">SWISS MEDICAL</option>
                                                        <option value="activa">ACTIVA SALUD</option>
                                                        <option value="medife">MEDIFE</option>
                                                        <option value="ospadep">OSPADEP SALUD</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="form-group">
                                                    <label class="form-label">
                                                        <i class="fas fa-minus-circle"></i>
                                                        Porcentaje de descuento
                                                    </label>
                                                    <div class="input-with-button">
                                                        <input type="number" id="revert-calc" step="0.1" placeholder="Ej: 2.5" class="form-input">
                                                        <span class="input-addon">%</span>
                                                        <button class="btn-primary" onclick="aplicarDescuentoDirecto()">
                                                            <i class="fas fa-arrow-down"></i>
                                                            Aplicar
                                                        </button>
                                                    </div>
                                                    <small class="form-hint">
                                                        <i class="fas fa-info-circle"></i>
                                                        Si aplicaste +2.5% de aumento, usa 2.5 para regresar al precio original
                                                    </small>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Sección Corrección de Precisión -->
                                        <div class="admin-tool-section precision-section">
                                            <div class="tool-header">
                                                <div class="tool-icon precision-icon">
                                                    <i class="fas fa-crosshairs"></i>
                                                </div>
                                                <div class="tool-info">
                                                    <h4>Corrección de Precisión</h4>
                                                    <p>Restaura los precios originales exactos eliminando errores de redondeo acumulativo.</p>
                                                </div>
                                            </div>
                                            
                                            <div class="tool-content">
                                                <div class="warning-card">
                                                    <div class="warning-icon">
                                                        <i class="fas fa-exclamation-triangle"></i>
                                                    </div>
                                                    <div class="warning-text">
                                                        <strong>¿Precios inexactos?</strong>
                                                        <p>Múltiples aumentos/descuentos pueden crear pequeñas variaciones por redondeo.</p>
                                                    </div>
                                                </div>
                                                
                                                <div class="form-group">
                                                    <label class="form-label">
                                                        <i class="fas fa-building"></i>
                                                        Prestador a restaurar
                                                    </label>
                                                    <select id="precision-prestador" class="form-select">
                                                        <option value="">Seleccionar prestador</option>
                                                        <option value="omint">OMINT</option>
                                                        <option value="swiss">SWISS MEDICAL</option>
                                                        <option value="activa">ACTIVA SALUD</option>
                                                        <option value="medife">MEDIFE</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="action-group">
                                                    <button class="btn-warning" onclick="corregirPrecisionUniversal()">
                                                        <i class="fas fa-undo-alt"></i>
                                                        Restaurar Precios Originales
                                                    </button>
                                                    <small class="form-hint">
                                                        <i class="fas fa-shield-alt"></i>
                                                        Esta acción reemplazará todos los precios del prestador con los valores originales exactos
                                                    </small>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="action-section">
                                            <button class="btn-primary large" onclick="aplicarAumentosExternos()">
                                                <i class="fas fa-calculator"></i>
                                                <span>Calcular y Generar Archivo</span>
                                            </button>
                                            <p class="action-help">Se descargará un archivo JSON actualizado que deberás subir como 'precios-data.json'</p>
                                        </div>
                                    </div>

                                    <!-- Tab 2: Importar CSV -->
                                    <div class="tab-panel" id="tab-csv">
                                        <div class="tab-panel-header">
                                            <h4><i class="fas fa-upload"></i> Importar Precios desde CSV</h4>
                                            <p>Arrastra tu archivo CSV o selecciónalo para procesar los precios automáticamente.</p>
                                        </div>
                                        
                                        <div class="csv-upload-zone">
                                            <div class="upload-area" ondrop="handleCSVDrop(event)" ondragover="allowDrop(event)">
                                                <div class="upload-icon">
                                                    <i class="fas fa-cloud-upload-alt"></i>
                                                </div>
                                                <div class="upload-text">
                                                    <h5>Arrastra tu archivo CSV aquí</h5>
                                                    <p>o haz clic para seleccionar</p>
                                                </div>
                                                <input type="file" id="csv-file" accept=".csv" onchange="handleCSVFile(event)" style="display: none;">
                                                <button class="btn-outline" onclick="document.getElementById('csv-file').click()">
                                                    <i class="fas fa-folder-open"></i>
                                                    Seleccionar Archivo
                                                </button>
                                            </div>
                                        </div>

                                        <div class="csv-preview-section" id="csv-preview" style="display: none;">
                                            <h5><i class="fas fa-eye"></i> Vista Previa del Archivo</h5>
                                            <div class="csv-content-preview">
                                                <pre id="csv-content"></pre>
                                            </div>
                                            <div class="action-section">
                                                <button class="btn-primary" onclick="procesarCSVExterno()">
                                                    <i class="fas fa-cogs"></i>
                                                    <span>Procesar CSV</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tab 3: Editor Manual -->
                                    <div class="tab-panel" id="tab-manual">
                                        <div class="tab-panel-header">
                                            <h4><i class="fas fa-edit"></i> Editor JSON Manual</h4>
                                            <p>Edita directamente el archivo JSON de precios para cambios específicos.</p>
                                        </div>
                                        
                                        <div class="json-editor-section">
                                            <div class="editor-toolbar">
                                                <button class="btn-outline small" onclick="cargarJSONActual()">
                                                    <i class="fas fa-sync-alt"></i>
                                                    Cargar Actual
                                                </button>
                                                <div class="editor-info">
                                                    <i class="fas fa-info-circle"></i>
                                                    <span>Edita con cuidado - Formato JSON requerido</span>
                                                </div>
                                            </div>
                                            
                                            <div class="json-editor-container">
                                                <textarea id="json-editor" rows="25" placeholder="Haz clic en 'Cargar Actual' para ver el contenido del archivo precios-data.json..."></textarea>
                                            </div>
                                            
                                            <div class="action-section">
                                                <button class="btn-primary" onclick="guardarJSONExterno()">
                                                    <i class="fas fa-save"></i>
                                                    <span>Generar Archivo Actualizado</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Footer con Acciones Principales -->
                                <div class="external-footer">
                                    <div class="footer-left">
                                        <button class="btn-secondary" onclick="hideExternalPricing()">
                                            <i class="fas fa-arrow-left"></i>
                                            Volver al Panel
                                        </button>
                                    </div>
                                    <div class="footer-right">
                                        <button class="btn-outline" onclick="descargarJSONExterno()">
                                            <i class="fas fa-download"></i>
                                            Descargar Respaldo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sección de aumento masivo -->
                        <div class="bulk-increase-section" id="bulk-increase-section" style="display: none;">
                            <div class="update-card increase-card">
                                <h3><i class="fas fa-arrow-up"></i> Aplicar Aumento Masivo</h3>
                                <p class="card-subtitle">Aumenta los precios de los planes seleccionados</p>
                                
                                <div class="update-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="increase-percentage">Porcentaje de aumento (%)</label>
                                            <input type="number" id="increase-percentage" step="0.1" min="0.1" placeholder="Ej: 1.5 para 1.5% de aumento" />
                                            <small class="field-help">Solo números positivos. Ej: 1.5 aumentará los precios un 1.5%</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="increase-category">Categoría de planes</label>
                                            <select id="increase-category">
                                                <option value="all">Todos los planes</option>
                                                <option value="individual">Solo planes individuales</option>
                                                <option value="familiar">Solo planes familiares</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-actions">
                                        <button class="update-btn increase-btn" onclick="applyBulkIncrease()">
                                            <i class="fas fa-plus"></i> Aplicar Aumento
                                        </button>
                                        <button class="cancel-btn" onclick="hideBulkIncrease()">
                                            Cancelar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sección de descuento masivo -->
                        <div class="bulk-decrease-section" id="bulk-decrease-section" style="display: none;">
                            <div class="update-card decrease-card">
                                <h3><i class="fas fa-arrow-down"></i> Aplicar Descuento Masivo</h3>
                                <p class="card-subtitle">Reduce los precios de los planes seleccionados</p>
                                
                                <div class="update-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="decrease-percentage">Porcentaje de descuento (%)</label>
                                            <input type="number" id="decrease-percentage" step="0.1" min="0.1" max="99" placeholder="Ej: 10 para 10% de descuento" />
                                            <small class="field-help">Solo números positivos. Ej: 10 reducirá los precios un 10%</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="decrease-category">Categoría de planes</label>
                                            <select id="decrease-category">
                                                <option value="all">Todos los planes</option>
                                                <option value="individual">Solo planes individuales</option>
                                                <option value="familiar">Solo planes familiares</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-actions">
                                        <button class="update-btn decrease-btn" onclick="applyBulkDecrease()">
                                            <i class="fas fa-minus"></i> Aplicar Descuento
                                        </button>
                                        <button class="cancel-btn" onclick="hideBulkDecrease()">
                                            Cancelar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Edición individual -->
                        <div class="individual-update-section" id="individual-update-section" style="display: none;">
                            <div class="update-card">
                                <h3><i class="fas fa-edit"></i> Edición Individual de Precios</h3>
                                <p class="card-subtitle">Modifica el precio de planes específicos</p>
                                
                                <div class="plans-list" id="admin-plans-list">
                                    <!-- Los planes se generarán dinámicamente -->
                                </div>
                                
                                <div class="form-actions">
                                    <button class="update-btn" onclick="saveIndividualChanges()">
                                        <i class="fas fa-save"></i> Guardar Cambios
                                    </button>
                                    <button class="cancel-btn" onclick="hideIndividualUpdate()">
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Secciones de histórico y precios eliminadas - Solo funciona el sistema de precios externos -->
                    </div>
                </div>
            </div>

            <!-- Panel de SuperAdmin -->
            <div class="super-admin-section" id="super-admin-section" style="display: none;">
                <div class="super-admin-container">
                    <div class="super-admin-header">
                        <button class="back-button" onclick="goToAdminPanel()">
                            <i class="fas fa-arrow-left"></i> Volver al panel administrativo
                        </button>
                        <h2><i class="fas fa-crown"></i> Panel de SuperAdministrador</h2>
                        <p class="subtitle">Control total del sistema y auditoría de usuarios</p>
                    </div>

                    <div class="super-admin-content">
                        <!-- Estadísticas generales -->
                        <div class="stats-overview">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="total-sessions">0</h3>
                                    <p>Sesiones totales</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="total-actions">0</h3>
                                    <p>Acciones registradas</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="avg-session">0m</h3>
                                    <p>Duración promedio</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="today-activity">0</h3>
                                    <p>Actividad hoy</p>
                                </div>
                            </div>
                        </div>

                        <!-- Controles de SuperAdmin -->
                        <div class="super-admin-controls">
                            <div class="control-section">
                                <h3><i class="fas fa-cogs"></i> Controles del Sistema</h3>
                                <div class="control-buttons">
                                    <button class="control-btn primary" onclick="showExternalPricing()">
                                        <i class="fas fa-cogs"></i> Gestión de Precios
                                    </button>
                                    <button class="control-btn secondary" onclick="goToMainPage()">
                                        <i class="fas fa-arrow-left"></i> Volver al Cotizador
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Secciones de SuperAdmin eliminadas - Solo funciona el sistema de precios externos -->
                    </div>
                </div>
            </div>
        </main>



        <!-- Modal de login administrativo -->
        <div class="admin-modal" id="admin-modal" style="display: none;">
            <div class="modal-overlay" onclick="hideAdminLogin()"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-lock"></i> Acceso Administrativo</h3>
                    <button class="modal-close" onclick="hideAdminLogin()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="login-form">
                        <div class="form-group">
                            <label for="login-username">Nombre de usuario *</label>
                            <input type="text" id="login-username" placeholder="Ingresa tu usuario" required />
                        </div>
                        <div class="form-group">
                            <label for="login-password">Contraseña *</label>
                            <input type="password" id="login-password" placeholder="Ingresa tu contraseña" required />
                            <div class="error-message" id="login-error"></div>
                        </div>
                        <div class="form-actions">
                            <button class="login-btn" onclick="handleLogin()">
                                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                            </button>
                        </div>
                        <!-- Credenciales removidas por seguridad -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para crear/editar usuario -->
        <div class="user-modal" id="user-modal" style="display: none;">
            <div class="modal-overlay" onclick="hideUserModal()"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="user-modal-title"><i class="fas fa-user-plus"></i> Crear Usuario</h3>
                    <button class="modal-close" onclick="hideUserModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="user-form" class="user-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="user-username">Nombre de usuario *</label>
                                <input type="text" id="user-username" required />
                                <small class="field-help">Solo letras, números y guiones bajos</small>
                            </div>
                            <div class="form-group">
                                <label for="user-name">Nombre completo *</label>
                                <input type="text" id="user-name" required />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="user-email">Email</label>
                                <input type="email" id="user-email" />
                            </div>
                            <div class="form-group">
                                <label for="user-role">Rol *</label>
                                <select id="user-role" required>
                                    <option value="">Seleccionar rol</option>
                                    <option value="user">Usuario</option>
                                    <option value="admin">Administrador</option>
                                    <option value="super_admin">Super Administrador</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="user-password">Contraseña *</label>
                                <input type="password" id="user-password" required />
                                <small class="field-help">Mínimo 6 caracteres</small>
                            </div>
                            <div class="form-group">
                                <label for="user-password-confirm">Confirmar contraseña *</label>
                                <input type="password" id="user-password-confirm" required />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-container">
                                <input type="checkbox" id="user-active" checked />
                                <span class="checkmark"></span>
                                Usuario activo
                            </label>
                        </div>
                        <div class="error-message" id="user-form-error"></div>
                        <div class="form-actions">
                            <button type="button" class="cancel-btn" onclick="hideUserModal()">
                                Cancelar
                            </button>
                            <button type="submit" class="save-btn">
                                <i class="fas fa-save"></i> Guardar Usuario
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 